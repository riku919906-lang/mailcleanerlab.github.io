<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mail Cleaner Lab â€“ Gmail æ•´ç†ãƒ„ãƒ¼ãƒ« | automaker-hub</title>

  <style>
    /* ===================== */
    /*   åŸºæœ¬ãƒ†ãƒ¼ãƒ          */
    /* ===================== */
    :root {
      --bg: #0f172a;
      --card-bg: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --border: #1f2937;
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --danger: #ef4444;
      --danger-soft: rgba(239, 68, 68, 0.15);
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.8);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 16px 40px;
    }

    /* ===================== */
    /*   ãƒ˜ãƒƒãƒ€ãƒ¼             */
    /* ===================== */
    header {
      padding: 8px 0 16px;
    }

    .headline {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }

    .headline-left h1 {
      margin: 0 0 4px;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .headline-left h1 .badge {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-sub);
    }

    .headline-left p {
      margin: 0;
      font-size: 0.82rem;
      color: var(--text-sub);
    }

    .headline-right {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .pill {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-sub);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill strong {
      color: var(--accent);
    }

    /* å•ã„åˆã‚ã›ãƒœã‚¿ãƒ³ */
    .btn-contact {
      padding: 8px 14px;
      background: rgba(30, 31, 41, 0.9);
      border: 1px solid #3a3b45;
      border-radius: 10px;
      color: #e4e4e7;
      font-size: 0.82rem;
      text-decoration: none;
      transition: 0.2s;
      display: inline-flex;
      align-items: center;
    }

    .btn-contact:hover {
      background: rgba(46, 47, 56, 0.9);
      border-color: #4b4c58;
    }

    /* OAuth ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
    .auth-area {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .btn-auth {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), #16a34a);
      color: #000;
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.45);
    }

    .btn-auth.secondary {
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-sub);
      box-shadow: none;
    }

    .btn-auth .icon {
      font-size: 1.1rem;
    }

    .pill-mini {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(55, 65, 81, 0.8);
      color: var(--text-sub);
    }

    .pill-mini .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    /* ===================== */
    /*   ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ     */
    /* ===================== */
    .layout {
      display: flex;
      gap: 18px;
      margin-top: 16px;
      align-items: flex-start;
    }

    .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 40%, #000 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.7);
      box-shadow: var(--shadow-soft);
      padding: 16px 18px;
      flex: 1;
      min-width: 0;
    }

    .card h2 {
      margin-top: 0;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card h2 .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .card .desc {
      margin: 6px 0 14px;
      font-size: 0.78rem;
      color: var(--text-sub);
      line-height: 1.5;
    }

    .section-label {
      font-size: 0.8rem;
      font-weight: 600;
      margin: 10px 0 4px;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .section-label .bar {
      display: inline-block;
      width: 3px;
      height: 14px;
      border-radius: 999px;
      background: linear-gradient(to bottom, var(--accent), transparent);
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.85rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
      font-family: inherit;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
      background: rgba(15, 23, 42, 0.98);
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .row-two {
      display: flex;
      gap: 8px;
    }

    .row-two > div {
      flex: 1;
    }

    .preset {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .preset button {
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
      font-size: 0.75rem;
      padding: 4px 10px;
      cursor: pointer;
      transition: background 0.15s, color 0.15s, border 0.15s, transform 0.1s;
    }

    .preset button:hover {
      background: rgba(34, 197, 94, 0.08);
      border-color: var(--accent);
      color: var(--accent);
      transform: translateY(-1px);
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-main,
    .btn-secondary,
    .btn-danger,
    .btn-ghost {
      flex: 1;
      min-width: 140px;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 0.86rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.08s ease-out, box-shadow 0.15s, background 0.15s, opacity 0.15s;
      white-space: nowrap;
    }

    .btn-main {
      background: linear-gradient(135deg, var(--accent), #22c55e);
      color: #000;
      box-shadow: 0 14px 30px rgba(34, 197, 94, 0.45);
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-sub);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #b91c1c);
      color: #fee2e2;
      box-shadow: 0 14px 30px rgba(239, 68, 68, 0.4);
    }

    .btn-ghost {
      background: transparent;
      border: 1px dashed rgba(75, 85, 99, 0.8);
      color: var(--text-sub);
    }

    .btn-main:hover,
    .btn-secondary:hover,
    .btn-danger:hover,
    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.6);
      opacity: 0.95;
    }

    .btn-main .icon,
    .btn-secondary .icon,
    .btn-danger .icon {
      font-size: 1rem;
    }

    select {
      background-image: linear-gradient(45deg, transparent 50%, #9ca3af 50%),
                        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position: calc(100% - 14px) 50%, calc(100% - 9px) 50%;
      background-size: 5px 5px, 5px 5px;
      background-repeat: no-repeat;
      appearance: none;
    }

    .result-block {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.1), transparent 55%);
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 10px 12px;
      margin-bottom: 10px;
    }

    .result-block.danger {
      background: radial-gradient(circle at top left, var(--danger-soft), transparent 55%);
      border-color: rgba(153, 27, 27, 0.9);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .result-header .title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-sub);
    }

    .result-header .counter {
      font-size: 0.75rem;
      color: var(--text-sub);
    }

    .ad-slot {
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      border: 1px dashed rgba(75, 85, 99, 0.9);
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.16), transparent 60%);
      font-size: 0.78rem;
      color: var(--text-sub);
    }

    .ad-slot strong {
      color: #93c5fd;
    }

    footer {
      margin-top: 16px;
      font-size: 0.7rem;
      color: #6b7280;
      text-align: right;
    }

    /* ã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-width: 768px) {
      .page {
        padding: 12px 10px 30px;
      }

      .layout {
        flex-direction: column;
      }

      .card {
        padding: 14px 14px 16px;
      }

      .headline {
        gap: 8px;
      }

      .headline-right {
        justify-content: flex-start;
      }

      .button-row {
        flex-direction: column;
      }

      .btn-main,
      .btn-secondary,
      .btn-danger,
      .btn-ghost {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="headline">
        <div class="headline-left">
          <h1>
            Gmail æ•´ç†ãƒ„ãƒ¼ãƒ«
            <span class="badge">Mail Cleaner Lab / automaker-hub</span>
          </h1>
          <p>ã„ã‚‰ãªã„ãƒ¡ãƒ¼ãƒ«ã‚’ä¸€æ°—ã«æ•´ç†ã€‚æ¤œç´¢æ¡ä»¶ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ã€å‰Šé™¤ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ»æ—¢èª­åŒ–ã¾ã§ã¾ã¨ã‚ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p>
        </div>
        <div class="headline-right">
          <span class="pill">
            Gmail ç”¨ãƒ„ãƒ¼ãƒ« / <strong>åç›ŠåŒ–å¯¾å¿œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ</strong>
          </span>
          <a href="contact.html" class="btn-contact">ãŠå•ã„åˆã‚ã›</a>
        </div>
      </div>

      <!-- OAuth ãƒœã‚¿ãƒ³ -->
      <div class="auth-area">
        <button id="oauth-btn" class="btn-auth">
          <span class="icon">ğŸ”</span>
          Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æºï¼ˆOAuthï¼‰
        </button>
        <button id="btn-signout" class="btn-auth secondary">
          <span class="icon">ğŸšª</span>
          åˆ‡æ–­ / ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
        </button>
        <span class="pill-mini" id="auth-status">
          <span class="dot"></span> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æœªé€£æº
        </span>
      </div>
    </header>

    <main class="layout">
      <!-- å·¦å´ï¼šæ¡ä»¶è¨­å®šã‚¨ãƒªã‚¢ -->
      <section class="card" aria-label="æ¡ä»¶è¨­å®š">
        <h2>
          <span class="dot"></span>
          æ¤œç´¢æ¡ä»¶ã®è¨­å®š
        </h2>
        <p class="desc">
          å‰Šé™¤ãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ»æ—¢èª­åŒ–ã—ãŸã„ãƒ¡ãƒ¼ãƒ«ã®æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br />
          ä¸‹ã®ã€Œãƒ—ãƒªã‚»ãƒƒãƒˆã€ã‹ã‚‰ã€ã‚ˆãä½¿ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§å‘¼ã³å‡ºã›ã¾ã™ã€‚
        </p>

        <div class="section-label">
          <span class="bar"></span> ã‚ˆãä½¿ã†ãƒ—ãƒªã‚»ãƒƒãƒˆ
        </div>
        <div class="preset">
          <button type="button" data-preset="rakuten">æ¥½å¤©ç³»ãƒ¡ãƒ¼ãƒ«</button>
          <button type="button" data-preset="amazon">Amazoné€šçŸ¥</button>
          <button type="button" data-preset="promo">åºƒå‘Šï¼ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³</button>
          <button type="button" data-preset="magazine">ãƒ¡ãƒ«ãƒã‚¬å…¨èˆ¬</button>
          <button type="button" data-preset="old-promo">30æ—¥ã‚ˆã‚Šå‰ã®ãƒ—ãƒ­ãƒ¢</button>
        </div>

        <div class="section-label">
          <span class="bar"></span> é€ä¿¡å…ƒï¼ˆfromï¼‰
        </div>
        <input id="from-input" type="text" placeholder="ä¾‹ï¼šnews@rakuten.co.jp / @example.com" />

        <div class="section-label">
          <span class="bar"></span> ä»¶åã«å«ã¾ã‚Œã‚‹è¨€è‘‰
        </div>
        <input id="subject-input" type="text" placeholder="ä¾‹ï¼šãƒ¡ãƒ«ãƒã‚¬, ã‚¯ãƒ¼ãƒãƒ³" />

        <div class="section-label">
          <span class="bar"></span> æœ¬æ–‡ã«å«ã¾ã‚Œã‚‹è¨€è‘‰
        </div>
        <input id="body-input" type="text" placeholder="ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°å¯" />

        <div class="section-label">
          <span class="bar"></span> é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        </div>
        <input id="exclude-input" type="text" placeholder="é‡è¦ãªé€šçŸ¥ãªã©é™¤å¤–ã—ãŸã„å ´åˆ" />

        <div class="row-two">
          <div>
            <div class="section-label">
              <span class="bar"></span> ã„ã¤ä»¥é™ã®ãƒ¡ãƒ¼ãƒ«
            </div>
            <input id="after-input" type="text" placeholder="ä¾‹ï¼š7d / 2024-01-01" />
          </div>
          <div>
            <div class="section-label">
              <span class="bar"></span> ã„ã¤ä»¥å‰ã®ãƒ¡ãƒ¼ãƒ«
            </div>
            <input id="before-input" type="text" placeholder="ä¾‹ï¼š30d / 2023-12-31" />
          </div>
        </div>

        <div class="section-label">
          <span class="bar"></span> ç”Ÿæˆã•ã‚ŒãŸæ¤œç´¢æ¡ä»¶ï¼ˆç·¨é›†å¯èƒ½ï¼‰
        </div>
        <textarea id="query-text" rows="4" placeholder="ã“ã“ã«æ¤œç´¢æ¡ä»¶ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™"></textarea>

        <div class="section-label">
          <span class="bar"></span> å®Ÿè¡Œã™ã‚‹æ“ä½œ
        </div>
        <select id="action-select">
          <option value="trash">ã‚´ãƒŸç®±ã¸ç§»å‹•ï¼ˆå‰Šé™¤ï¼‰</option>
          <option value="archive">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option>
          <option value="read">æ—¢èª­ã«ã™ã‚‹</option>
        </select>

        <div class="button-row">
          <button id="btn-generate" class="btn-main">
            <span class="icon">âœ¨</span> æ¤œç´¢æ¡ä»¶ã‚’è‡ªå‹•ç”Ÿæˆ
          </button>
          <button id="btn-preview" class="btn-secondary">
            <span class="icon">ğŸ”</span> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼‰
          </button>
          <button id="btn-execute" class="btn-danger">
            <span class="icon">âš ï¸</span> ã“ã®æ¡ä»¶ã§å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆï¼‰
          </button>
        </div>
      </section>

      <!-- å³å´ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ / å®Ÿè¡Œçµæœã‚¨ãƒªã‚¢ -->
      <section class="card" aria-label="å®Ÿè¡Œçµæœ">
        <h2>
          <span class="dot"></span>
          ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨å®Ÿè¡Œçµæœ
        </h2>
        <p class="desc">
          å®Ÿè¡Œå‰ã«å¿…ãšãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€æœ¬å½“ã«æ¶ˆã—ã¦ã‚ˆã„ãƒ¡ãƒ¼ãƒ«ã ã‘ãŒå¯¾è±¡ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚
        </p>

        <div class="result-block">
          <div class="result-header">
            <span class="title">ç¾åœ¨ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
            <span class="counter" id="preview-count-label">å¯¾è±¡ä»¶æ•°: - ä»¶ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</span>
          </div>
          <textarea id="preview-text" rows="6" placeholder="ã€Œæ¤œç´¢æ¡ä»¶ã‚’è‡ªå‹•ç”Ÿæˆ â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã®é †ã«æ“ä½œã™ã‚‹ã¨ã€ã“ã“ã«çµæœã®ä¾‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"></textarea>
        </div>

        <div class="result-block danger">
          <div class="result-header">
            <span class="title">å®Ÿè¡Œçµæœ</span>
            <span class="counter" id="result-count-label">æœ€çµ‚ä»¶æ•°: - ä»¶ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</span>
          </div>
          <textarea id="result-text" rows="6" placeholder="ã¾ã å®Ÿè¡Œçµæœã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œã“ã®æ¡ä»¶ã§å®Ÿè¡Œã€ã‚’æŠ¼ã™ã¨ã€ã“ã“ã«å®Ÿè¡Œå†…å®¹ã®å±¥æ­´ï¼ˆå®Ÿè¡Œçµæœï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"></textarea>
        </div>

        <div class="button-row">
          <button id="btn-clear-result" class="btn-ghost">
            å®Ÿè¡Œçµæœã‚’ã‚¯ãƒªã‚¢
          </button>
        </div>

        <div class="ad-slot">
          <strong>åç›Šã‚¹ãƒšãƒ¼ã‚¹ï¼ˆå°†æ¥ç”¨ï¼‰</strong><br />
          ã“ã“ã«åºƒå‘ŠãƒãƒŠãƒ¼ã€ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã€æœ‰æ–™ç‰ˆã¸ã®å°ç·šãªã©ã‚’è¿½åŠ ã§ãã¾ã™ã€‚<br />
          ä¾‹ï¼š<br />
          ãƒ»ã€Œé«˜é€Ÿç‰ˆã€ã‚„ã€Œè‡ªå‹•å®šæœŸå®Ÿè¡Œç‰ˆã€ã¸ã®ãƒªãƒ³ã‚¯<br />
          ãƒ»ãƒ¡ãƒ¼ãƒ«æ–­æ¨é›¢ã®ãƒã‚¦ãƒã‚¦è¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯
        </div>
      </section>
    </main>

    <footer>
      Mail Cleaner Lab â€“ Gmail è‡ªå‹•æ•´ç†ãƒ„ãƒ¼ãƒ«ï¼ˆautomaker-hub ç‰ˆï¼‰
    </footer>
  </div>

  <!-- ===================== -->
  <!--   JavaScript éƒ¨åˆ†      -->
  <!-- ===================== -->
  <script>
    // ====== OAuth è¨­å®š ======
    const CLIENT_ID = "923017588150-th43jikkldliggrt258aqg95hrk2ob73.apps.googleusercontent.com";
    const REDIRECT_URI = "https://automaker-hub.github.io/";
    const SCOPES = "https://www.googleapis.com/auth/gmail.modify";

    const authStatusEl = document.getElementById("auth-status");

    function setAuthStatus(connected) {
      if (!authStatusEl) return;
      authStatusEl.innerHTML =
        '<span class="dot"></span> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ' + (connected ? "é€£æºæ¸ˆã¿ âœ”" : "æœªé€£æº");
    }

    // Google OAuth é–‹å§‹
    function loginWithGoogle() {
      const url =
        "https://accounts.google.com/o/oauth2/v2/auth" +
        "?client_id=" + encodeURIComponent(CLIENT_ID) +
        "&redirect_uri=" + encodeURIComponent(REDIRECT_URI) +
        "&response_type=token" +
        "&scope=" + encodeURIComponent(SCOPES) +
        "&include_granted_scopes=true" +
        "&prompt=consent";

      window.location.href = url;
    }

    document.getElementById("oauth-btn").addEventListener("click", loginWithGoogle);

    // ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
    document.getElementById("btn-signout").addEventListener("click", () => {
      localStorage.removeItem("gmail_token");
      setAuthStatus(false);
      alert("ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
    });

    // ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
    function extractAccessToken() {
      const hash = window.location.hash.substring(1);
      if (hash) {
        const params = new URLSearchParams(hash);
        const token = params.get("access_token");
        if (token) {
          localStorage.setItem("gmail_token", token);
          setAuthStatus(true);
          console.log("Google OAuth æˆåŠŸï¼ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
          // ãƒãƒƒã‚·ãƒ¥ã‚’URLã‹ã‚‰æ¶ˆã—ã¦è¦‹ãŸç›®ã‚’ã‚­ãƒ¬ã‚¤ã«
          history.replaceState(null, "", window.location.pathname + window.location.search);
          return;
        }
      }
      // æ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆ
      const existing = localStorage.getItem("gmail_token");
      setAuthStatus(!!existing);
    }

    extractAccessToken();

    // ==========================
    // Gmail æ¤œç´¢ãƒ„ãƒ¼ãƒ«å´ã®å‡¦ç†
    // ==========================
    const queryTextEl = document.getElementById("query-text");
    const previewTextEl = document.getElementById("preview-text");
    const resultTextEl = document.getElementById("result-text");
    const previewCountLabel = document.getElementById("preview-count-label");
    const resultCountLabel = document.getElementById("result-count-label");

    // æ¤œç´¢æ¡ä»¶ã‚’çµ„ã¿ç«‹ã¦
    function buildGmailQuery() {
      const from = document.getElementById("from-input").value.trim();
      const subject = document.getElementById("subject-input").value.trim();
      const body = document.getElementById("body-input").value.trim();
      const exclude = document.getElementById("exclude-input").value.trim();
      const after = document.getElementById("after-input").value.trim();
      const before = document.getElementById("before-input").value.trim();

      const parts = [];

      if (from) {
        parts.push(`from:(${from})`);
      }
      if (subject) {
        parts.push(`subject:(${subject})`);
      }
      if (body) {
        parts.push(`{${body}}`);
      }
      if (exclude) {
        parts.push(`-{${exclude}}`);
      }
      if (after) {
        parts.push(`after:${after}`);
      }
      if (before) {
        parts.push(`before:${before}`);
      }

      return parts.join(" ");
    }

    // ãƒ—ãƒªã‚»ãƒƒãƒˆé©ç”¨
    function applyPreset(key) {
      const fromInput = document.getElementById("from-input");
      const subjectInput = document.getElementById("subject-input");
      const bodyInput = document.getElementById("body-input");
      const excludeInput = document.getElementById("exclude-input");
      const afterInput = document.getElementById("after-input");
      const beforeInput = document.getElementById("before-input");

      // ä¸€æ—¦ãƒªã‚»ãƒƒãƒˆ
      fromInput.value = "";
      subjectInput.value = "";
      bodyInput.value = "";
      excludeInput.value = "";
      afterInput.value = "";
      beforeInput.value = "";

      switch (key) {
        case "rakuten":
          fromInput.value = "@rakuten.co.jp";
          subjectInput.value = "ãƒã‚¤ãƒ³ãƒˆ, ãŠå¾—, ã‚»ãƒ¼ãƒ«";
          break;
        case "amazon":
          fromInput.value = "@amazon.co.jp";
          subjectInput.value = "ãŠã™ã™ã‚, ã‚»ãƒ¼ãƒ«, ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³";
          break;
        case "promo":
          bodyInput.value = "ã‚»ãƒ¼ãƒ«, ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³, åºƒå‘Š";
          break;
        case "magazine":
          subjectInput.value = "ãƒ¡ãƒ«ãƒã‚¬, newsletter";
          break;
        case "old-promo":
          bodyInput.value = "ã‚»ãƒ¼ãƒ«, ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³, åºƒå‘Š";
          beforeInput.value = "30d";
          break;
      }

      const query = buildGmailQuery();
      queryTextEl.value = query;
    }

    // æ¤œç´¢æ¡ä»¶ã‚’è‡ªå‹•ç”Ÿæˆ
    function handleGenerateQuery() {
      const query = buildGmailQuery();
      queryTextEl.value = query;
      if (!query) {
        alert("æ¤œç´¢æ¡ä»¶ãŒç©ºã§ã™ã€‚é€ä¿¡å…ƒã‚„ä»¶åãªã©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      }
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå®Ÿéš›ã«ã¯ãƒ€ãƒŸãƒ¼ï¼‰
    function handlePreview() {
      const query = queryTextEl.value.trim();
      if (!query) {
        alert("æ¤œç´¢æ¡ä»¶ãŒç©ºã§ã™ã€‚ã€Œæ¤œç´¢æ¡ä»¶ã‚’è‡ªå‹•ç”Ÿæˆã€ã‚’æŠ¼ã™ã‹ã€æ¡ä»¶ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      // å®Ÿé‹ç”¨ã§ã¯ Gmail API ã§ä»¶æ•°ã‚’å–å¾—
      previewCountLabel.textContent = "å¯¾è±¡ä»¶æ•°: ã‚µãƒ³ãƒ—ãƒ«ã§ 123 ä»¶";
      previewTextEl.value =
        "ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‘\n" +
        "æ¤œç´¢æ¡ä»¶: " + query + "\n\n" +
        "å®Ÿéš›ã« Gmail API ã‚’ã¤ãªãã¨ã€ã“ã“ã«ãƒ’ãƒƒãƒˆã—ãŸãƒ¡ãƒ¼ãƒ«ã®ä»¶æ•°ã‚„ä¸€éƒ¨ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚";
    }

    // å®Ÿè¡Œï¼ˆã„ã¾ã¯ãƒ€ãƒŸãƒ¼ã§ãƒ­ã‚°ã ã‘ï¼‰
    function handleExecute() {
      const query = queryTextEl.value.trim();
      const action = document.getElementById("action-select").value;

      if (!query) {
        alert("æ¤œç´¢æ¡ä»¶ãŒç©ºã§ã™ã€‚ã¾ãšãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      if (!confirm("ã“ã®æ¡ä»¶ã§æœ¬ç•ªå®Ÿè¡Œã™ã‚‹æƒ³å®šã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚\nâ€» å®Ÿéš›ã® Gmail ã«ã¯ã¾ã ä½•ã‚‚ã—ã¾ã›ã‚“ã€‚")) {
        return;
      }

      let actionLabel = "";
      if (action === "trash") actionLabel = "ã‚´ãƒŸç®±ã¸ç§»å‹•ï¼ˆå‰Šé™¤ï¼‰";
      if (action === "archive") actionLabel = "ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–";
      if (action === "read") actionLabel = "æ—¢èª­ã«ã™ã‚‹";

      // å®Ÿé‹ç”¨ã§ã¯ users.messages.batchModify ãªã©ã‚’å‘¼ã¶
      resultCountLabel.textContent = "æœ€çµ‚ä»¶æ•°: ã‚µãƒ³ãƒ—ãƒ«ã§ 123 ä»¶";
      const now = new Date().toLocaleString("ja-JP");
      const log =
        "=== å®Ÿè¡Œçµæœï¼ˆãƒ†ã‚¹ãƒˆï¼‰ ===\n" +
        "æ—¥æ™‚: " + now + "\n" +
        "æ“ä½œ: " + actionLabel + "\n" +
        "æ¤œç´¢æ¡ä»¶: " + query + "\n" +
        "å¯¾è±¡ä»¶æ•°ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰: 123 ä»¶\n\n" +
        (resultTextEl.value ? resultTextEl.value + "\n\n" : "");
      resultTextEl.value = log;
    }

    function handleClearResult() {
      resultTextEl.value = "";
      resultCountLabel.textContent = "æœ€çµ‚ä»¶æ•°: - ä»¶ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰";
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆç´ã¥ã‘
    document.getElementById("btn-generate").addEventListener("click", handleGenerateQuery);
    document.getElementById("btn-preview").addEventListener("click", handlePreview);
    document.getElementById("btn-execute").addEventListener("click", handleExecute);
    document.getElementById("btn-clear-result").addEventListener("click", handleClearResult);

    document.querySelectorAll(".preset button").forEach((btn) => {
      btn.addEventListener("click", () => {
        const key = btn.getAttribute("data-preset");
        applyPreset(key);
      });
    });
  </script>
</body>
</html>
<!-- updated: fix redirect -->
